# ChroLens Portal 自動發布工具使用說明

## 📦 功能特色

這個工具可以自動完成以下步驟：
1. ✅ 打包程式（PyInstaller）
2. ✅ 創建 ZIP 壓縮包
3. ✅ 自動上傳到 GitHub Releases
4. ✅ 自動生成 Release Notes

---

## 🚀 快速開始

### 方式一：使用批次檔（推薦）

1. 雙擊執行 `打包並發布.bat`
2. 首次使用會要求輸入 GitHub Token
3. 等待打包完成
4. 確認是否上傳到 GitHub

### 方式二：使用 Python 腳本

```bash
python build_and_release.py
```

---

## 🔑 GitHub Token 設定（首次使用）

### 步驟 1: 創建 Personal Access Token

1. 前往 https://github.com/settings/tokens/new
2. 填寫以下資訊：
   - **Note**: ChroLens Portal Release
   - **Expiration**: 90 days 或 No expiration
   - **Select scopes**: 
     - ✅ `repo` (完整勾選)

3. 點擊「Generate token」
4. **重要**: 複製生成的 Token（離開頁面後就看不到了）

### 步驟 2: 輸入 Token

執行打包腳本時，會提示輸入 Token：
```
請輸入您的 GitHub Token: [貼上你的 Token]
```

Token 會自動保存到 `.github_token` 文件（已加入 .gitignore，不會上傳到 Git）

### 步驟 3: 重置 Token（可選）

如果需要更換 Token：
1. 刪除 `.github_token` 文件
2. 重新執行打包腳本

---

## 📋 發布流程

### 1. 更新版本號

在 `ChroLens_Portal.py` 中修改：
```python
CURRENT_VERSION = "2.5.2"  # 修改版本號
```

### 2. 更新版本記錄

在 `ChroLens_Portal.py` 的頂部添加更新內容：
```python
# === 版本更新紀錄 ===
# [2.5.2] - 新功能描述
# - 新增功能 A
# - 修復 Bug B
# - 優化性能 C
```

### 3. 執行打包腳本

```bash
# 使用批次檔
打包並發布.bat

# 或使用 Python
python build_and_release.py
```

### 4. 確認發布

腳本會詢問：
```
是否要上傳到 GitHub Releases? (Y/n):
```

- 輸入 `Y` 或直接按 Enter：自動上傳
- 輸入 `n`：只打包，不上傳（可手動上傳）

### 5. 完成！

發布成功後會顯示 Release 連結，例如：
```
🎉 發布成功!
🔗 查看 Release: https://github.com/Lucienwooo/ChroLens_Portal/releases/tag/v2.5.2
```

---

## 📝 Release Notes 格式

腳本會自動從代碼中的版本記錄提取更新內容，並格式化為：

```markdown
# ChroLens Portal v2.5.2

## ✨ 新增功能與改進
- 新增功能 A
- 優化性能 C

## 🐛 錯誤修復
- 修復 Bug B

## 📦 安裝方式
...
```

---

## ⚙️ 進階設定

### 修改 GitHub 倉庫

編輯 `build_and_release.py`：
```python
self.github_repo = "Lucienwooo/ChroLens_Portal"  # 修改為你的倉庫
```

### 跳過某些步驟

如果只想打包不發布，執行打包後選擇 `n`：
```
是否要上傳到 GitHub Releases? (Y/n): n
```

### 手動上傳 ZIP

如果自動上傳失敗，可以手動上傳：
1. 前往 https://github.com/Lucienwooo/ChroLens_Portal/releases/new
2. Tag: `v2.5.2`
3. 上傳 `dist/ChroLens_Portal_v2.5.2.zip`

---

## 🔧 疑難排解

### 問題 1: PyGithub 未安裝

```bash
pip install PyGithub
```

### 問題 2: Token 認證失敗

1. 檢查 Token 是否有 `repo` 權限
2. 刪除 `.github_token` 重新輸入
3. 確認 Token 未過期

### 問題 3: Release 已存在

腳本會詢問是否刪除並重建：
```
⚠ Release v2.5.2 已存在
是否刪除並重新創建? (y/N): y
```

### 問題 4: 打包失敗

1. 確認已安裝 PyInstaller
2. 關閉正在運行的 ChroLens_Portal.exe
3. 刪除 `build/` 和 `dist/` 目錄後重試

---

## 📚 相關文件

- `build_and_release.py` - 主要打包與發布腳本
- `build_simple.py` - 簡單打包腳本（不上傳）
- `打包並發布.bat` - Windows 批次檔
- `打包.bat` - 簡單打包批次檔

---

## 🎯 最佳實踐

1. **版本號規範**: 使用語義化版本（2.5.1, 2.5.2...）
2. **更新記錄**: 每次發布前更新版本記錄
3. **測試**: 打包後先測試再發布
4. **備份**: 重要版本建議手動備份 ZIP

---

## 💡 提示

- Token 只需設定一次，會自動保存
- 支援斷點續傳（如果打包完成但上傳失敗）
- Release Notes 會自動從代碼提取
- 上傳的 ZIP 檔案名稱會包含版本號

---

**作者**: Lucien  
**更新日期**: 2025-11-21
